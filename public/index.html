<script>
  const API_URL = "https://quicktelbundles.onrender.com/stkpush"; // full URL to your backend

  async function buyBundle(amount) {
    const phone = document.getElementById("phone").value.trim();

    if (!/^2547\d{8}$/.test(phone)) {
      alert("Please enter a valid Safaricom number in format 2547XXXXXXXX");
      return;
    }

    if (!confirm(`Buy bundle worth KES ${amount} for ${phone}?`)) return;

    try {
      const res = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ phone, amount })
      });

      const data = await res.json();
      if (res.ok) {
        alert("✅ STK Push sent to your phone. Enter PIN to complete.");
      } else {
        alert("❌ Failed: " + (data.details?.errorMessage || data.message || "Unknown error"));
      }
    } catch (err) {
      alert("❌ Network/CORS Error: " + err.message);
    }
  }
</script>
</body>
</html>